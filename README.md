# 作業メモ デスクトップアプリ（app_task_memo）

## 概要
Windows 11 向けの軽量な作業メモアプリです。`tkinter` ベースで動作し、タグ選択式の入力欄を最大 10 レーン提供。1クリックで行単位にログへ追記でき、プレビューで最新ログを即確認できます。任意で Windows の音声入力（SAPI）や、OpenAI API を用いた LLM 質問エリアも利用できます。

- 実行環境: Windows 11 / Python 3.12
- ログ日付の区切り: 毎日 04:00（午前4時）
- UI: 通常サイズ/拡大サイズのトグル切替
- 10レーン構成: TAG / SUB_TAG / テキスト / 音声入力ボタン / 行別「登録」
- LLM質問エリア: プリセット/自由入力 → 応答を表示し、ログにも追記
- 設定/ログのパスを明示表示、エクスプローラーでワンクリックオープン

<img width="821" height="997" alt="スクリーンショット 2025-08-30 195557" src="https://github.com/user-attachments/assets/0f469cd7-7bd0-492b-8cda-dbc62f2634ca" />

## 主な機能
- タグ選択式の入力レーン（最大10）
  - `TAGS` のカテゴリとサブカテゴリ（SUB_TAG）をプルダウンから選択
  - テキスト入力後に各行の「登録」で即時にログへ追記
- ログプレビュー
  - 末尾中心の軽量読み込みで最新ログをテキスト表示（選択してコピー可）
  - 04:00 を越えたら自動で新しい日付のログファイルへロールオーバー
- メニュー
  - ファイル: 設定ファイルを開く / ログフォルダを開く / 終了
  - 表示: サイズ変更（通常/拡大）
- 音声入力（任意）
  - Windows SAPI を利用（環境に `pywin32` がある場合のみ有効）
  - レーンごとの 🎤 ボタンで開始/停止。認識テキストは該当レーン末尾に追記
- LLM質問エリア（任意）
  - `BASE_PROMPTS` からプリセット選択、または自由入力
  - OpenAI REST (chat.completions) を標準ライブラリのみで直接呼び出し
  - 応答は画面に表示し、`[LLM][USER_NAME] Q:... / A:...` 形式でログにも残す

## 画面構成（概要）
- 上部バー: 現在日時表示、サイズ変更ボタン
- 入力エリア: 10レーン（TAG / SUB_TAG / テキスト / 🎤 / 行別「登録」）
- ログ簡易表示: 現在のログファイル末尾をテキストで表示
- 下部情報: 設定ファイルパスとログファイルパスの表示
- LLM質問エリア: 表示切替可（チェックボックス）

## ログ仕様
- 出力先: `LOG_DIR` に `app_task_memo_YYYYMMDD_DOW.log`（例: `app_task_memo_20250830_SAT.log`）
- 文字コード: UTF-8 (BOM 付き) `utf-8_sig`
- 日付境界: 04:00 を越えるとファイルを切り替え
- 1行フォーマット（通常入力）:
  - `YYYY-MM-DD HH:MM [TAG____] [SUB_TAG] 本文`
  - 角括弧は最低幅を確保（既定: 8）
- 1行フォーマット（LLM応答）:
  - `YYYY-MM-DD HH:MM [LLM] [USER_NAME] Q:<質問> / A:<回答>`

## セットアップ
### 前提
- Windows 11 / Python 3.12
- 追加ライブラリは不要（音声入力機能のみ `pywin32` があると有効化）

### 取得と起動
```bash
python app_task_memo/app_task_memo.py
```

### （任意）音声入力の有効化
- `pip install pywin32`
- 利用可否は自動判定。利用不可の環境では 🎤 ボタン押下時に案内を表示

### （任意）OpenAI API キー設定
- 環境変数で設定（推奨）
  - PowerShell: `setx OPENAI_API_KEY "sk-xxxxx"`
  - cmd.exe: `setx OPENAI_API_KEY "sk-xxxxx"`
- または `app_task_memo.yaml` の `OPENAI_API_KEY` に直接記載
- 環境変数名は `OPENAI_API_KEY_ENV` で変更可（既定: `OPENAI_API_KEY`）

## 設定ファイル（app_task_memo.yaml）
アプリ起動時に同ディレクトリへ自動生成されます。主なキーは以下の通りです。

- `LOG_DIR`: ログ保存ディレクトリ（空の場合はアプリと同階層）。相対パスはアプリ基準
- `USER_NAME`: LLMログに記録するユーザー名
- `MAIN_TAG`: 初期選択用のメインタグ配列（最大10件、各レーンへ順に適用）
- `TAGS`: `{カテゴリ: [サブカテゴリ,...]}` の辞書。レーンのプルダウンに反映
- `BASE_PROMPTS`: LLMプリセット名と内容の辞書
- `LLM_PROVIDER`: 既定 `openai`（現状 OpenAI REST のみサポート）
- `LLM_MODEL`: 例 `gpt-4o-mini`
- `LLM_MAX_COMPLETION_TOKENS`: 応答最大トークン数
- `LLM_TIMEOUT`: タイムアウト秒
- `OPENAI_API_KEY_ENV`: APIキーを読む環境変数名（既定 `OPENAI_API_KEY`）
- `OPENAI_API_KEY`: 直接キーを記述する場合に使用（空なら環境変数を参照）

設定例（抜粋）:
```yaml
LOG_DIR: ""
USER_NAME: "User"
MAIN_TAG: []
TAGS:
  仕事: [コーディング, デバッグ, レビュー]
  学習: [読書, 実践]
  生活: [運動, 食事]
BASE_PROMPTS:
  要約: "次の文章を要約してください。"
  アイデア: "次のテーマからアイデアを10個列挙してください。"
LLM_PROVIDER: "openai"
LLM_MODEL: "gpt-4o-mini"
LLM_MAX_COMPLETION_TOKENS: 2000
LLM_TIMEOUT: 60
OPENAI_API_KEY_ENV: "OPENAI_API_KEY"
OPENAI_API_KEY: ""
```

## 使い方
1. アプリを起動すると、上部に現在時刻、中央に10レーンの入力欄、下部にログ情報が表示されます。
2. 各レーンで `TAG` と `SUB_TAG` を選択し、テキストを入力します。
3. 行右端の「登録」を押すと、その行の内容がログファイルに追記されます。
4. 「🎤」を押すとそのレーンの音声入力を開始/停止します（対応環境のみ）。
5. 下部のパス表示から、設定/ログをエクスプローラーで開けます。
6. LLM 質問エリアはチェックボックスで表示切替できます。プリセット選択または自由入力後に「送信」を押すと、回答が表示され、ログにも追記されます。
7. 「表示 > サイズ変更」で UI を拡大/縮小できます。

## LLM（OpenAI）
- 呼び出し: `https://api.openai.com/v1/chat/completions`
- 実装: Python 標準の `urllib.request` による直接呼び出し（ストリーミングなし）
- ボタン活性条件: プリセット選択 or 自由入力があり、かつ API キーが設定されていること
- 失敗時: ステータスラベルにエラーを表示し、実行中は「送信中...」を表示
- ログ追記: 応答表示と同時に 1 行で Q/A を追記

## 音声入力（SAPI / 任意）
- 判定: `pywin32` が導入済みかつ Windows SAPI が利用可能な場合のみ有効
- 操作: レーンごとの 🎤 で開始/停止。認識結果は該当レーンのテキスト末尾に追記
- 内部: In-Proc Recognizer を使用し、Tk のイベントループ上で定期的に COM メッセージをポンピング

## 補足/ベストプラクティス
- タグ設計:
  - よく使うカテゴリを `MAIN_TAG` に指定すると初期選択が効率化
  - `TAGS` は辞書の定義順で表示（Python 3.7+ の順序保持）
- ログ活用:
  - プレビューは選択コピーが可能。日次の振り返りや要約に活用
  - LLM の「振り返り」プリセットで当日ログから良かった点/改善点を抽出

## トラブルシューティング
- LLM ボタンが無効のまま
  - API キーが未設定です。環境変数または YAML の `OPENAI_API_KEY` を設定
- 音声入力が使えない
  - `pywin32` が未導入、または SAPI が利用不可の可能性。案内ダイアログを参照
- エクスプローラーで開けない
  - パスの権限や存在を確認してください（権限不足だと失敗します）
- YAML が正しく解釈されない
  - 本アプリの YAML パーサは簡易実装です。`KEY: value` とインデント、`- item` の基本構造に沿ってください

## 既知の制限
- LLM プロバイダは現状 OpenAI REST のみ
- 応答は非ストリーミングで受信
- YAML パーサは機能限定（アンカー/参照/複雑な型は非対応）
- UI スケールは 2 段階（通常/拡大）

---
このアプリは「速く書いて、すぐ残す」を目的に、依存最小で設計されています。必要に応じて `app_task_memo.yaml` を調整し、ご自身のワークフローに最適化してお使いください。

